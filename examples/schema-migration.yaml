version: 0.1

name: schema-migration-v1
description: Standard workflow for backend schema migrations
model: auto

workspace:
  base_branch: main
  branch_prefix: agent/
  auto_commit: true

context:
  include_repo_tree: true
  include_git_diff: false

agents:
  planner:
    prompt: agents/planner.md
    read_only: true

  implementer:
    prompt: agents/implementer.md
    read_only: false

skills:
  - skills/migration_patterns.md
  - skills/repo_rules.md

steps:
  - name: plan
    agent: planner
    mode: plan
  - name: implement
    agent: implementer
  - name: self_review
    agent: implementer

constraints:
  max_iterations: 5
  max_diff_lines: 800
  require_tests: true

output:
  create_pr: true
  pr_template: templates/pr.md
